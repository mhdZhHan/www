---
import { Image } from "astro:assets";

export type Props = {
  images: (string | ImageMetadata)[];
};

const { images } = Astro.props;
const carouselAnimationTime = `${images.length * 6}s`;
---

<div class="carousel">
  <ul id="carousel_images">
    {
      images.map((img, index) => (
        <Image
          class="carousel-item"
          style={{ animationDelay: `${index * 6}s` }}
          decoding="async"
          loading="lazy"
          src={typeof img === "string" ? img : img.src}
          alt={`Carousel image ${index + 1}`}
          width={1920}
          height={1080}
          format="webp"
          quality={80}
        />
      ))
    }
  </ul>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const carouselImages = document.getElementById("carousel_images");
    if (carouselImages) {
      const carouselImagesCount = carouselImages.children.length;

      if (carouselImagesCount > 0) {
        const styleElement = document.createElement("style");
        const carouselAnimation = `
          @keyframes carousel-animation {
            0% {
              opacity: 0;
              transform: scale(1);
            }
            3% {
              opacity: 1;
            }
            8% {
              opacity: 1;
              animation-timing-function: ease-out;
            }
            ${100 / carouselImagesCount}% {
              opacity: 1;
            }
            ${100 / carouselImagesCount + 50 / carouselImagesCount}% {
              opacity: 0;
              animation-timing-function: ease-out;
            }
            100% {
              opacity: 0;
              transform: scale(2);
            }
          }
        `;
        styleElement.textContent = carouselAnimation;
        document.head.appendChild(styleElement);
      }
    }
  });
</script>

<style define:vars={{ carouselAnimationTime }}>
  @reference "@/global.css";

  .carousel {
    @apply absolute left-0 top-0 -z-10 block h-full w-full overflow-hidden bg-gray-100;
  }

  .carousel::before {
    @apply absolute left-0 top-0 z-10 block h-full w-full bg-black/25 transition-all content-[''];
  }

  .carousel-item {
    @apply absolute left-0 top-0 z-0 h-full w-full origin-center opacity-0 object-cover;
    animation: carousel-animation var(--carouselAnimationTime) linear infinite
      0s;
    backface-visibility: hidden;
    transform-style: preserve-3d;
  }

  .carousel-image {
    @apply h-full w-full object-cover;
  }
</style>
